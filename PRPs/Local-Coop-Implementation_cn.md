# æœ¬åœ°åˆä½œæ¨¡å¼å®ç°è®¡åˆ’

## æ¦‚è¿°
ä¸ºJumpJumpJumpå®ç°æ”¯æŒåŒæ‰‹æŸ„çš„æœ¬åœ°åˆä½œå¤šäººæ¸¸æˆã€‚

## å·²å®Œæˆç»„ä»¶ âœ…

### 1. LocalCoopManagerï¼ˆ`frontend/src/utils/LocalCoopManager.ts`ï¼‰
- ç®¡ç†åˆä½œè®¾ç½®å’Œç©å®¶çŠ¶æ€
- è·Ÿè¸ªç©å®¶ç”Ÿå‘½å€¼ã€ç”Ÿå‘½æ•°ã€åˆ†æ•°
- æ‰‹æŸ„æ£€æµ‹å’Œè¾“å…¥å¤„ç†
- ç©å®¶å‡†å¤‡çŠ¶æ€ç®¡ç†

### 2. CoopPlayerManagerï¼ˆ`frontend/src/utils/CoopPlayerManager.ts`ï¼‰
- åˆ›å»ºå’Œç®¡ç†ä¸¤ä¸ªç©å®¶ç²¾çµ
- å¤„ç†ç©å®¶UIï¼ˆç”Ÿå‘½æ¡ã€ç”Ÿå‘½æ•°ã€æ ‡ç­¾ï¼‰
- ç©å®¶ä¼¤å®³å’Œæ­»äº¡ç³»ç»Ÿ
- é‡ç”Ÿæœºåˆ¶
- ç›¸æœºç„¦ç‚¹è®¡ç®—

### 3. CoopLobbySceneï¼ˆ`frontend/src/scenes/CoopLobbyScene.ts`ï¼‰
- æ‰‹æŸ„è¿æ¥æ£€æµ‹
- ç©å®¶å‡†å¤‡ç³»ç»Ÿ
- åŒæ–¹ç©å®¶çš„è§†è§‰æŒ‡ç¤ºå™¨
- åŒæ–¹å‡†å¤‡å°±ç»ªæ—¶çš„å¼€å§‹æŒ‰é’®

### 4. èœå•é›†æˆ
- åœ¨MenuSceneä¸­æ·»åŠ "æœ¬åœ°åˆä½œ"æŒ‰é’®
- å°†CoopLobbySceneé›†æˆåˆ°App.tsxåœºæ™¯åˆ—è¡¨
- æ›´æ–°èœå•å¸ƒå±€ä»¥é€‚åº”æ–°æŒ‰é’®

## å‰©ä½™å·¥ä½œ ğŸš§

### GameSceneä¿®æ”¹

GameSceneéœ€è¦æ›´æ–°ä»¥æ”¯æŒåˆä½œæ¨¡å¼ã€‚ä»¥ä¸‹æ˜¯éœ€è¦ä¿®æ”¹çš„å†…å®¹ï¼š

#### 1. æ·»åŠ åˆä½œæ¨¡å¼æ£€æµ‹
```typescript
// åœ¨create()æ–¹æ³•ä¸­ï¼Œæ£€æŸ¥æ¸¸æˆæ•°æ®å
if (data && data.mode === 'coop') {
  this.isCoopMode = true
  this.coopPlayerManager = new CoopPlayerManager(this, this.platforms)
}
```

#### 2. ç©å®¶åˆ›å»ºé€»è¾‘
- **å½“å‰**ï¼šå•ä¸ª`this.player`ç²¾çµ
- **éœ€è¦**ï¼šæ£€æŸ¥`isCoopMode`å¹¶ï¼š
  - åˆ›å»ºå•ä¸ªç©å®¶ï¼ˆç°æœ‰ä»£ç ï¼‰
  - æˆ–è°ƒç”¨`coopPlayerManager.createPlayers()`åˆ›å»ºåŒç©å®¶

#### 3. æ›´æ–°å¾ªç¯ä¿®æ”¹
`update()`æ–¹æ³•éœ€è¦å¤„ç†åŒæ–¹ç©å®¶ï¼š

```typescript
// å¯¹äºåˆä½œæ¨¡å¼ä¸­çš„æ¯ä¸ªç©å®¶ï¼š
// - è·å–æ‰‹æŸ„è¾“å…¥
// - åº”ç”¨ç§»åŠ¨å’Œè·³è·ƒ
// - å¤„ç†å°„å‡»
// - æ›´æ–°æªæ”¯ä½ç½®
// - æ›´æ–°åŠ¨ç”»
// - æ£€æŸ¥ç¢°æ’
```

#### 4. ç›¸æœºç³»ç»Ÿ
- **å•äºº**ï¼šè·Ÿéš`this.player`
- **åˆä½œæ¨¡å¼**ï¼šè·ŸéšåŒæ–¹ç©å®¶ä¹‹é—´çš„ä¸­å¿ƒç‚¹
- è€ƒè™‘åŸºäºç©å®¶è·ç¦»çš„åŠ¨æ€ç¼©æ”¾

#### 5. ç¢°æ’æ£€æµ‹
æ‰€æœ‰ç°æœ‰ç¢°æ’éœ€è¦å¯¹åŒæ–¹ç©å®¶ç”Ÿæ•ˆï¼š
- å¹³å°ç¢°æ’
- æ•Œäººç¢°æ’
- å°–åˆºç¢°æ’
- é‡‘å¸æ”¶é›†
- é“å…·æ”¶é›†
- Bossæ”»å‡»

#### 6. åˆ†æ•°å’Œè¿›åº¦
- åˆå¹¶åˆ†æ•°è¿˜æ˜¯å•ç‹¬åˆ†æ•°ï¼Ÿ
- åŒæ–¹ç©å®¶çš„æ£€æŸ¥ç‚¹ç³»ç»Ÿ
- åŒæ–¹éƒ½åˆ°è¾¾ä¼ é€é—¨æ—¶å…³å¡å®Œæˆ

### å®ç°ç­–ç•¥

ç”±äºGameScene.tsæœ‰4827è¡Œï¼Œæˆ‘ä»¬å°†ä½¿ç”¨**åŒ…è£…å™¨æ¨¡å¼**ï¼š

1. åˆ›å»º`CoopGameMode.ts`è¾…åŠ©ç±»
2. è¯¥ç±»å°è£…æ‰€æœ‰åˆä½œæ¨¡å¼ç‰¹å®šçš„æ¸¸æˆé€»è¾‘
3. å½“`isCoopMode === true`æ—¶GameSceneå§”æ‰˜ç»™æ­¤è¾…åŠ©ç±»
4. å¯¹ç°æœ‰GameSceneä»£ç çš„æœ€å°æ”¹åŠ¨

### åŒ…è£…å™¨æ¨¡å¼ç¤ºä¾‹

```typescript
// CoopGameMode.ts
export class CoopGameMode {
  private playerManager: CoopPlayerManager
  private scene: GameScene
  
  handleUpdate(time: number, delta: number) {
    const players = this.playerManager.getBothPlayers()
    
    for (const player of players) {
      this.handlePlayerMovement(player)
      this.handlePlayerShooting(player)
      this.handlePlayerAnimations(player)
    }
    
    this.updateCamera()
  }
  
  updateCamera() {
    const focus = this.playerManager.getCameraFocusPoint()
    this.scene.cameras.main.scrollX = focus.x - 640
    this.scene.cameras.main.scrollY = focus.y - 360
  }
}

// åœ¨GameScene.ts update()ä¸­
update(time: number, delta: number) {
  if (this.isCoopMode && this.coopGameMode) {
    this.coopGameMode.handleUpdate(time, delta)
    return
  }
  
  // ...ç°æœ‰å•äººæ›´æ–°ä»£ç 
}
```

## æµ‹è¯•æ¸…å•

- [ ] å¤§å…ä¸­æ£€æµ‹åˆ°ä¸¤ä¸ªæ‰‹æŸ„
- [ ] åŒæ–¹ç©å®¶éƒ½å¯ä»¥å‡†å¤‡
- [ ] æ¸¸æˆå¼€å§‹æ—¶åŒæ–¹ç©å®¶å¯è§
- [ ] æ¯ä¸ªç©å®¶ç‹¬ç«‹ç§»åŠ¨
- [ ] æ¯ä¸ªç©å®¶ç‹¬ç«‹å°„å‡»
- [ ] ç”Ÿå‘½æ¡æ­£ç¡®æ›´æ–°
- [ ] ç›¸æœºè·ŸéšåŒæ–¹ç©å®¶
- [ ] ç¢°æ’å¯¹åŒæ–¹ç©å®¶æœ‰æ•ˆ
- [ ] æ­»äº¡å’Œé‡ç”Ÿæ­£å¸¸å·¥ä½œ
- [ ] åŒæ–¹ç©å®¶æ­»äº¡æ—¶æ¸¸æˆç»“æŸ
- [ ] å…³å¡å®Œæˆæ­£å¸¸å·¥ä½œ
- [ ] å¯ä»¥è¿”å›èœå•
- [ ] å¯ä»¥é‡æ–°å¼€å§‹æ¸¸æˆ

## å·²çŸ¥é™åˆ¶

1. **æ— åœ¨çº¿å¤šäºº** - ä»…é™æœ¬åœ°
2. **éœ€è¦ä¸¤ä¸ªæ‰‹æŸ„** - é”®ç›˜ä¸æ”¯æŒç©å®¶2
3. **å…±äº«å±å¹•** - æ— åˆ†å±æ¨¡å¼
4. **æ¸¸æˆå¹³è¡¡** - æ•Œäººç”Ÿæˆå°šæœªé’ˆå¯¹2åç©å®¶è°ƒæ•´

## ä¸‹ä¸€æ­¥

1. åˆ›å»º`CoopGameMode.ts`è¾…åŠ©ç±»
2. ä¿®æ”¹GameScene.tsä½¿ç”¨åŒ…è£…å™¨æ¨¡å¼
3. ç”¨ä¸¤ä¸ªæ‰‹æŸ„æµ‹è¯•
4. ä¸ºåˆä½œæ¨¡å¼å¹³è¡¡æ•Œäººç”Ÿæˆ
5. å®Œå–„UIå’Œè§†è§‰åé¦ˆ
