# PRP: 商店系统实现 (Shop System Implementation)

## 问题陈述
为了给收集到的金币提供用途并增加游戏的进度感，游戏需要一个商店系统，玩家可以在其中购买升级、新武器和装饰性皮肤。这增加了一个收集资源以改善未来游戏体验的元游戏循环。

## 需求
- 显示当前金币余额
- 列出可用物品（武器、皮肤、道具）
- 处理购买交易（扣除金币，解锁物品）
- 跨会话持久化已购买的物品
- 立即装备已购买的物品或进行选择
- 分页界面以支持多种物品
- 为买得起/买不起的物品提供视觉反馈

## 提议的解决方案

### 架构
1. **场景**: `ShopScene.ts`
2. **数据存储**: `localStorage` 键:
   - `player_coins`: 可用金币总数。
   - `purchased_items`: 已解锁物品 ID 的 JSON 数组。
   - `equipped_skin`: 当前选择的皮肤 ID。
   - `equipped_weapon`: 当前选择的武器 ID。
3. **物品类型**:
   - **武器**: 改变投射物行为（散射、速度、伤害）。
   - **皮肤**: 改变玩家精灵外观。
   - **道具**: 消耗品，如生命药水（恢复生命）。

## 实现细节

### 1. 商店物品
商店提供各种不同价格的物品：

#### 武器
- **基础爆能枪** (默认): 标准投射物。
- **连射枪** (500 金币): 更快的射击速度。
- **散射枪** (1000 金币): 锥形发射 3 个投射物。
- **激光束** (2000 金币): 高速、穿透性投射物。

#### 皮肤
- **蓝色外星人** (默认)
- **绿色外星人** (200 金币)
- **粉色外星人** (500 金币)
- **黄色外星人** (1000 金币)

#### 道具
- **生命药水** (100 金币): 恢复 1 点生命（消耗品）。

### 2. 界面设计
- **网格布局**: 2 行 x 3 列（每页 6 个物品）。
- **物品卡片**:
   - 图标（程序生成或精灵）。
   - 名称和价格。
   - 购买/装备按钮。
- **导航**: 上一页/下一页按钮。
- **反馈**:
   - 如果资金不足，"购买"按钮变灰。
   - 活动物品显示 "已装备" 标签。
   - 非消耗性已购物品显示 "已拥有" 标签。

### 3. 技术实现
- **程序化图标**: 武器图标使用 `Phaser.Graphics` 生成，以避免原型对外部资源的依赖。
- **交易逻辑**:
  ```typescript
  buyItem(item) {
    if (coins >= item.price) {
      coins -= item.price
      if (!item.consumable) {
        purchasedItems.add(item.id)
      }
      saveData()
      updateUI()
    }
  }
  ```

## 创建/修改的文件
- `frontend/src/scenes/ShopScene.ts`
- `frontend/src/__tests__/shop-scene.test.ts`
